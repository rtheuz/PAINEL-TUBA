<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerador de Etiquetas</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap');

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(35deg, #a6c0fe, #4d8164, #f9fbb6);
      background-size: 600% 600%;
      animation: gradMove 10s ease infinite;
    }

    @keyframes gradMove {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 14px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .btn-back {
      appearance: none;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      gap: 6px;
      align-items: center;
      background: #f0f0f0;
      color: #333;
      font-size: 14px;
      transition: background 0.2s;
    }

    .btn-back:active {
      background: #e0e0e0;
    }

    .header h2 {
      margin: 0;
      color: #1a73e8;
      font-size: 17px;
      flex: 1;
    }

    .form-container {
      padding: 16px;
      max-width: 600px;
      margin: 0 auto;
      padding-bottom: 100px; /* Espa√ßo extra para o bot√£o aparecer no iframe */
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(12px);
      padding: 18px;
      border-radius: 14px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      margin-bottom: 14px;
    }

    .card-title {
      font-size: 13px;
      font-weight: 600;
      color: #1a73e8;
      margin: 0 0 14px 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      color: #333;
      font-size: 14px;
    }

    input[type="text"],
    input[type="date"],
    select {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      font-family: 'Montserrat', sans-serif;
      background: white;
      transition: border-color 0.2s;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: #1a73e8;
    }

    /* NOVO: Grid para dimens√µes */
    .dim-grid {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 10px;
      align-items: center;
    }

    .dim-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .dim-label {
      font-size: 11px;
      font-weight: 600;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      text-align: center;
    }

    .dim-grid input {
      text-align: center;
      font-weight: 600;
      font-size: 18px;
      padding: 14px 8px;
    }

    .dim-sep {
      font-weight: bold;
      font-size: 24px;
      color: #999;
      user-select: none;
      padding-top: 20px; /* Alinha com os inputs */
    }

    .input-group {
      display: flex;
      gap: 8px;
    }

    .input-group select,
    .input-group input {
      flex: 1;
    }

    .btn-gerar {
      width: 100%;
      padding: 16px;
      background: #1a73e8;
      color: white;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Montserrat', sans-serif;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
      margin-bottom: 20px; /* Espa√ßo extra no final */
    }

    .btn-gerar:active:enabled {
      transform: scale(0.98);
      background: #1662c1;
    }

    .btn-gerar:disabled {
      background: #cfcfcf;
      cursor: not-allowed;
      box-shadow: none;
    }

    .preview-data {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    @media (max-width: 480px) {
      .header {
        padding: 10px 16px;
      }

      .header h2 {
        font-size: 15px;
      }

      .btn-back {
        padding: 6px 10px;
        font-size: 13px;
      }

      .form-container {
        padding: 12px;
        padding-bottom: 120px; /* Mais espa√ßo em mobile */
      }

      .card {
        padding: 14px;
      }

      .card-title {
        font-size: 12px;
      }

      .dim-grid input {
        font-size: 16px;
        padding: 12px 6px;
      }

      .dim-sep {
        font-size: 20px;
      }
    }
  </style>
</head>

<body>
  <div class="header">
    <button class="btn-back" onclick="voltarPagina()">‚Üê Voltar</button>
    <h2>Gerador de Etiquetas</h2>
  </div>

  <div class="form-container">
    <!-- Identifica√ß√£o -->
    <div class="card">
      <h3 class="card-title">üìã Identifica√ß√£o</h3>
      
      <div class="form-group">
        <label for="prop">Propriedade</label>
        <input type="text" id="prop" value="TUBA FERRAMENTARIA">
      </div>

      <div class="form-group">
        <label for="tipo">Tipo</label>
        <select id="tipo">
          <option value="">Selecione</option>
          <option value="Retalho" selected>Retalho</option>
          <option value="Int.">Int.</option>
        </select>
      </div>

    <!-- Dimens√µes e Material -->
    <div class="card">
      <h3 class="card-title">üìè Dimens√µes e Material</h3>
      
      <div class="form-group">
        <label>Dimens√µes (mm)</label>
        <div class="dim-grid">
          <div class="dim-field">
            <span class="dim-label">Comprimento</span>
            <input id="dim1" type="text" inputmode="numeric" pattern="\d*" maxlength="5" value="3000" />
          </div>
          <span class="dim-sep">√ó</span>
          <div class="dim-field">
            <span class="dim-label">Largura</span>
            <input id="dim2" type="text" inputmode="numeric" pattern="\d*" maxlength="5" value="1200" />
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="esp">Espessura (mm)</label>
        <input type="text" id="esp" value="4,5">
      </div>

      <div class="form-group">
        <label for="material">Material</label>
        <div class="input-group">
          <select id="material">
            <option value="ALUM√çNIO">Alum√≠nio</option>
            <option value="A√áO N√ÉO QUALIFICADO" selected>A√ßo n√£o qualificado</option>
            <option value="A√áO INOX">A√ßo inox</option>
            <option value="A√áO ASTM A36">A√ßo ASTM A36</option>
            <option value="A√áO ABNT 1010">A√ßo ABNT 1010</option>
            <option value="A√áO ABNT 1020">A√ßo ABNT 1020</option>
            <option value="FERRO">Ferro</option>
            <option value="COBRE">Cobre</option>
            <option value="LAT√ÉO">Lat√£o</option>
            <option value="outro">Outro‚Ä¶</option>
          </select>
          <input type="text" id="materialOutro" placeholder="Digite material" style="display:none;">
        </div>
      </div>

      <div class="form-group">
        <label for="qtde">Quantidade de Chapas</label>
        <input type="text" id="qtde" value="1" inputmode="numeric">
      </div>
    </div>

    <!-- Fornecedor e NF -->
    <div class="card">
      <h3 class="card-title">üè¢ Fornecedor e Nota Fiscal</h3>
      
      <div class="form-group">
        <label for="fornecedor">Fornecedor</label>
        <div class="input-group">
          <select id="fornecedor">
            <option value="ALDIFER" selected>Aldifer</option>
            <option value="ALUM√çNIO ABD">Alum√≠nio ABD</option>
            <option value="ACERLOR MITTAL">Acerlor Mittal</option>
            <option value="HIPER FERRO">Hiper Ferro</option>
            <option value="PIRES DO RIO">Pires do Rio</option>
            <option value="S√ì METAIS">S√≥ Metais</option>
            <option value="SIANFER">Sianfer</option>
            <option value="SOUFER">Soufer</option>
            <option value="SUL FERRO">Sul Ferro</option>
            <option value="outro">Outro‚Ä¶</option>
          </select>
          <input type="text" id="fornecedorOutro" placeholder="Digite fornecedor" style="display:none;">
        </div>
      </div>

      <div class="form-group">
        <label for="dataEntrada">Data de Entrada</label>
        <input type="date" id="dataEntrada" value="">
        <div id="dataPreview" class="preview-data"></div>
      </div>

      <div class="form-group">
        <label for="nf">Nota Fiscal (NF)</label>
        <input type="text" id="nf" value="1234" inputmode="numeric">
      </div>
    </div>

    <!-- Bot√£o Gerar -->
    <button class="btn-gerar" id="gerarBtn" type="button">Gerar Etiqueta</button>
  </div>

  <script>
    const token = "<?= token ?>";

    (function () {

      const btn = document.getElementById("gerarBtn");
      const prop = document.getElementById("prop");
      const tipo = document.getElementById("tipo");
      const dim1 = document.getElementById("dim1");
      const dim2 = document.getElementById("dim2");
      const esp = document.getElementById("esp");
      const material = document.getElementById("material");
      const materialOutro = document.getElementById("materialOutro");
      const dataEntrada = document.getElementById("dataEntrada");
      const fornecedor = document.getElementById("fornecedor");
      const fornecedorOutro = document.getElementById("fornecedorOutro");
      const nf = document.getElementById("nf");
      const dataPreview = document.getElementById("dataPreview");
      const qtde = document.getElementById("qtde");

      // data de hoje
      const hoje = new Date();
      const ano = hoje.getFullYear();
      const mes = String(hoje.getMonth() + 1).padStart(2, '0');
      const dia = String(hoje.getDate()).padStart(2, '0');
      dataEntrada.value = `${ano}-${mes}-${dia}`;

      // s√≥ n√∫meros nos campos de dimens√£o
      function onlyDigits(el) {
        el.addEventListener("input", function () {
          this.value = this.value.replace(/\D/g, "").slice(0, 6);
        });
      }
      onlyDigits(dim1);
      onlyDigits(dim2);

      // lidar com "Outro"
      function setupOutro(selectEl, outroEl) {
        selectEl.addEventListener("change", () => {
          if (selectEl.value === "outro") {
            outroEl.style.display = "block";
            setTimeout(() => outroEl.focus(), 100);
          } else {
            outroEl.style.display = "none";
          }
        });
        outroEl.addEventListener("blur", () => {
          const val = outroEl.value.trim();
          if (val && !Array.from(selectEl.options).some(o => o.value === val)) {
            const option = document.createElement("option");
            option.value = val;
            option.text = val;
            selectEl.insertBefore(option, selectEl.querySelector('option[value="outro"]'));
            selectEl.value = val;
            outroEl.style.display = "none";
          }
        });
      }
      setupOutro(material, materialOutro);
      setupOutro(fornecedor, fornecedorOutro);

      function collectDados() {
        const dimA = dim1.value.trim() || "";
        const dimB = dim2.value.trim() || "";
        const mat = material.value === "outro" ? materialOutro.value.trim() : material.value;
        const forn = fornecedor.value === "outro" ? fornecedorOutro.value.trim() : fornecedor.value;

        return {
          prop: prop.value.trim(),
          tipo: tipo.value,
          dim: (dimA || dimB) ? `${dimA} x ${dimB}` : "",
          dim1: dimA,
          dim2: dimB,
          esp: esp.value.trim(),
          material: mat,
          dataEntrada: dataEntrada.value,
          fornecedor: forn,
          nf: nf.value.trim(),
          qtde: qtde.value.trim()
        };
      }

      btn.addEventListener("click", function () {
        if (btn.disabled) return;
        btn.disabled = true;
        btn.innerText = "Gerando...";

        const dados = collectDados();

        google.script.run
          .withSuccessHandler(function (url) {
            if (url) window.open(url, "_blank");
            btn.innerText = "‚úÖ Etiqueta Gerada!";
            setTimeout(() => {
              btn.disabled = false;
              btn.innerText = "Gerar Etiqueta";
            }, 1200);
          })
          .withFailureHandler(function (err) {
            alert("Erro ao gerar etiqueta: " + (err.message || err));
            btn.disabled = false;
            btn.innerText = "Gerar Etiqueta";
          })
          .gerarEtiqueta(dados, token);
      });
    })();

    function voltarPagina() {
      if (!token) {
        alert("Token n√£o encontrado ‚Äî recarregue a p√°gina.");
        return;
      }
      const baseUrl = "https://script.google.com/macros/s/AKfycbyqo2sqE_x5VhtQPInTBS4XO78vk-S0Ec2LbgDtbUYVyX98oOA_oh4VRMdrmk8DBWvx6g/exec";
      window.location.href = `${baseUrl}?page=dashboard&token=${token}`;
    }
  </script>
</body>

</html>